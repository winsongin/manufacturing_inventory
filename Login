import tkinter as tk
import mysql.connector as sql

mydb = sql.connect(
        host = 'localhost',
        user = 'root',
        passwd = 'P@nchito14',
        database = 'inventory_manager'
        )

cur = mydb.cursor()
#gets Usernames from Database
def getUser(u):
   #try:
    statement = ("select employee_id from employees where employee_id = '{}'").format(u)
    cur.execute(statement)
    result = cur.fetchone()
    result = ''.join(result)
    if result == u:
        return True
    else:
        return False
    #if not in database then throw an error


#gets Passwords from Database
def getPass(p):
    statement = ("select pass from employees where pass = '{}'").format(p)
    cur.execute(statement)
    result = cur.fetchone()
    if result == None:
        return True
    
    result = ''.join(result)
   
    if result == p:
         return False
    #if the password is not in the database
    else:
         return True
    #if not in database then throw an error
    #try again 
    #reset password

#Temporary Switch Screen
def switch(d):
    temp = d
    ltemp = tk.Label(frmA, text = temp)
    ltemp.pack()
    frmHome.pack_forget()
    frmA.pack()
    #Potential Work

#Find Department For User
def finddept(uid):
    d = []
    statement = ("select dept from employees where employee_id= '{}'").format(uid)
    cur.execute(statement)
    results = cur.fetchone()
    for x in results:
        ts = ''.join(x)
        d.append(ts)
    return (d[0])     

#Login Function
def login():
    lock = True                                                  
    found = False                                                
    name = eUsername.get()
    found = getUser(name)
    password = ePassword.get()
    lock = getPass(password)
    print(lock)
    if found == True and lock == False:
        print('Logged in')
        dept = finddept(name)
        switch(dept)
    else:
        print('Try Again')
        
#Window Creation
win = tk.Tk()

win.title("Login")
win.geometry("600x500") #width and height

frmHome = tk.Frame(win, height = 400)
frmHome.pack()

frmA = tk.Frame(win)

#Label object 

lUsername = tk.Label(frmHome, text = 'Employee ID')

lPassword = tk.Label(frmHome, text = 'Password')

#Variables to Store Data

user = tk.StringVar()

passwd = tk.StringVar()

#Entry object

eUsername = tk.Entry(frmHome, textvariable = user)

ePassword = tk.Entry(frmHome, textvariable = passwd, show ='*')

#Button

bLogin = tk.Button(frmHome, text = 'Login', command = login)

#placing in GUI

lUsername.pack(side= tk.TOP, anchor = 'w', expand = 'true')

eUsername.pack(side= tk.TOP, anchor = 'center', expand = 'true', fill = 'x')

lPassword.pack(side= tk.TOP, anchor = 'w', expand = 'true')

ePassword.pack(side= tk.TOP, anchor = 'center', expand = 'true', fill = 'x')

bLogin.pack(side = tk.BOTTOM, anchor = 'center')

win.mainloop()
